



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Secrets, credentials, and other cloak-and-dagger stuff">
      
      
        <link rel="canonical" href="https://dfds.github.io/secrets/">
      
      
        <meta name="author" content="thfis">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="./assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.4">
    
    
      
        <title>Secrets</title>
      
    
    
      <link rel="stylesheet" href="./assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="./assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="./assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="./assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="./stylesheets/critic.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#secrets" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://dfds.github.io/secrets/" title="Secrets" class="md-header-nav__button md-logo">
          
            <i class="md-icon">security</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              Secrets
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/dfds/secrets/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      dfds/secrets
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://dfds.github.io/secrets/" title="Secrets" class="md-nav__button md-logo">
      
        <i class="md-icon">security</i>
      
    </a>
    Secrets
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/dfds/secrets/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      dfds/secrets
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Secrets
      </label>
    
    <a href="." title="Secrets" class="md-nav__link md-nav__link--active">
      Secrets
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goalsconsiderationsrequirements" title="Goals/Considerations/Requirements" class="md-nav__link">
    Goals/Considerations/Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secret-management" title="Secret Management" class="md-nav__link">
    Secret Management
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secret-manager" title="Secret Manager" class="md-nav__link">
    Secret Manager
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conventions" title="Conventions" class="md-nav__link">
    Conventions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws-ssm-parameter-store" title="AWS SSM Parameter Store" class="md-nav__link">
    AWS SSM Parameter Store
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes" title="Kubernetes" class="md-nav__link">
    Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consuming-secrets-in-kubernetes" title="Consuming Secrets in Kubernetes" class="md-nav__link">
    Consuming Secrets in Kubernetes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#targets" title="Targets" class="md-nav__link">
    Targets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-kubernetes-manifests" title="Example kubernetes manifests" class="md-nav__link">
    Example kubernetes manifests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="application-developers/" title="Application Developers" class="md-nav__link">
      Application Developers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="sre/" title="SRE" class="md-nav__link">
      SRE
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goalsconsiderationsrequirements" title="Goals/Considerations/Requirements" class="md-nav__link">
    Goals/Considerations/Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secret-management" title="Secret Management" class="md-nav__link">
    Secret Management
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secret-manager" title="Secret Manager" class="md-nav__link">
    Secret Manager
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conventions" title="Conventions" class="md-nav__link">
    Conventions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws-ssm-parameter-store" title="AWS SSM Parameter Store" class="md-nav__link">
    AWS SSM Parameter Store
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes" title="Kubernetes" class="md-nav__link">
    Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consuming-secrets-in-kubernetes" title="Consuming Secrets in Kubernetes" class="md-nav__link">
    Consuming Secrets in Kubernetes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#targets" title="Targets" class="md-nav__link">
    Targets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-kubernetes-manifests" title="Example kubernetes manifests" class="md-nav__link">
    Example kubernetes manifests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/dfds/secrets/edit/master/docs/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="secrets">Secrets<a class="headerlink" href="#secrets" title="Permanent link">&para;</a></h1>
<p>Secrets, including credentials, are handled thus:</p>
<h2 id="goalsconsiderationsrequirements">Goals/Considerations/Requirements<a class="headerlink" href="#goalsconsiderationsrequirements" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>NO</strong> plain text secrets (credentials, or otherwise) in any codebase.</li>
<li>Play nice together with our current Kubernetes security setup (assumed roles and kiam) <mark class="critic"> external link perhaps? </mark>.</li>
<li>Facilitate our current take on Kubernetes (one capability/team/project/microservice ecosystem/namespace).</li>
<li>API enabled.</li>
<li>Terraform(able).</li>
<li>Free (as in no subscription charge).</li>
<li>No code.</li>
<li>Use Kubernetes concepts.</li>
<li><mark class="critic"> others? </mark></li>
<li>Does not need to emcompass other configurations (e.g. feature toggles)</li>
<li>Easy to manage and deliver secrets</li>
</ul>
<span class="critic comment">KIAM - Integrate AWS IAM with Kubernetes</span>
<div class="admonition note">
<p class="admonition-title">Alternatives</p>
<p>Below is a list of some of the alternatives that have been tried/considered:</p>
<ul>
<li>Sealed Secrets (secrets are encrypted and then included in the codebases)</li>
<li>Vault (free, highly scalable, unmanged)</li>
<li>AWS Secrets Manager (paid)</li>
<li>Cloud KMS (paid)</li>
<li>Azure Key Vault (paid)</li>
<li><mark class="critic"> others? </mark></li>
</ul>
</div>
<h2 id="secret-management">Secret Management<a class="headerlink" href="#secret-management" title="Permanent link">&para;</a></h2>
<p>What we would like to achieve is an easy way for application developers to store and manage secrets in secure fashion, while at the same time give applications access to the secrets through standard Kubernetes features, and without using custom code to fetch remote secrets on application startup.</p>
<p>This has led us to identity the following needs:</p>
<ul>
<li>A central cloud storage for secrets.</li>
<li>Kubernetes secrets, with automatic lifecycle management (create, update, delete).</li>
<li>AWS IAM access level control, using roles-</li>
<li><mark class="critic"> others? </mark></li>
</ul>
<p>Overview of the current working solution:</p>
<div class="codehilite"><pre><span></span> ╔════════════════════╗
 ║ Secret Sources...¹ ║
 ╚════════════════════╝
           │
╔══════╗   │  ╔═══════════════════════════════════════╗
║ SSM² ║◄──┘  ║               Kubernetes³             ║
╚══════╝      ║               ‾‾‾‾‾‾‾‾‾‾              ║
   ▲          ║ ╔═══════════════════════════════════╗ ║
   │          ║ ║             Capability⁴           ║ ║
   │          ║ ║             ‾‾‾‾‾‾‾‾‾‾            ║ ║
   │          ║ ║  ╔══════╗  ╔═════════╗  ╔══════╗  ║ ║
   └──────────║─║─►║  SM⁷ ║─►║ SECRET⁵ ║─►║ POD⁶ ║  ║ ║
              ║ ║  ╚══════╝  ╚═════════╝  ╚══════╝  ║ ║
              ║ ╚═══════════════════════════════════╝ ║
              ╚═══════════════════════════════════════╝
</pre></div>

<p>Components:</p>
<ol>
<li><em>Secret Sources</em> could literally be anything, but will most likely be a combination of coordinates (i.e. URI) and credentials for either managed services provisioned using Terraform, or some external source (third-party managed).</li>
<li><em>SSM</em> is AWS Systems Manager Parameter Store (see info box below)</li>
<li>Our <em>Kubernetes</em> cluster.</li>
<li><em>Capability</em> is the current level of granularity regarding workspace allocation. This currently aligns with namespace in Kubernetes. <mark class="critic">We need explanation here - maybe something about microservice ecosystem! </mark></li>
<li><em>SECRET</em> is a collection of key/value pairs that are collected in a single Kubernetes secret. The secrets can then be configured in the pod (or deployment) manifest, in order for an application/microservice to gain access to their values. This can be as environment variable and/or file mounts. An example is listed below.</li>
<li>The <em>POD</em> contains the application/microservice that whats access to the secret.</li>
<li><em>SM</em>, or <a href="#secret-manager">Secret Manager</a>.</li>
</ol>
<div class="admonition info">
<p class="admonition-title">AWS Systems Manager Parameter Store</p>
<p>The <em>Parameter Store</em> is a secure, scalable, and managed configuration store that allows storage of data in hierarchies and track versions. It integrates into other AWS offerings (include AWS Lambda), and offers control and audit access at granular levels.</p>
</div>
<h2 id="secret-manager">Secret Manager<a class="headerlink" href="#secret-manager" title="Permanent link">&para;</a></h2>
<p>The Secret Manager is an infrastructure component running in the same namespace as the <em>POD⁶</em> above, with AWS access rights (kiam) to pull secrets from <em>SSM²</em>.</p>
<p>It will, at regular intervals, pull secrets from <em>SSM²</em> according to access rights and <a href="#conventions">conventions</a>, and manage secrets according to these conventions. Thus keeping everything in sync.</p>
<div class="admonition info">
<p class="admonition-title">NB</p>
<p><em>Only secrets created by the Secret Manager are managed, all other secrets will be left untouched.</em></p>
</div>
<h2 id="conventions">Conventions<a class="headerlink" href="#conventions" title="Permanent link">&para;</a></h2>
<p>The management of secrets are controlled by the use of conventions. We operate with the following conventions that will be used to synchronize secrets between system.</p>
<ul>
<li>
<p><strong>Capability</strong></p>
<p>Our current scope for a workspace is the Capability, which roughly translates to a <mark class="critic"> team/project/product </mark> that own an microservice ecosystem, which again (presently) translates to a namespace in Kubernetes.</p>
</li>
<li>
<p><strong>Environment</strong></p>
<p>In order to operate with different environments <span class="critic comment"> YAGNI? </span>, we reserve a placeholder for this. However, this will default to <em>prod</em> for now. <span class="critic comment"> Huh? </span></p>
</li>
<li>
<p><strong>Application</strong></p>
<p>The name of the application that requires secrets.</p>
</li>
<li>
<p><strong>Secret Key</strong></p>
<p>The name of the secret</p>
</li>
</ul>
<p>Together these four conventions, allow us to manage secrets in SSM, and propagate these SSM parameters (based on conventions and readily available attribute in Kubernetes) to PODs and applications in the form of Kubernetes secrets.</p>
<h3 id="aws-ssm-parameter-store">AWS SSM Parameter Store<a class="headerlink" href="#aws-ssm-parameter-store" title="Permanent link">&para;</a></h3>
<p>Secrets are using the hierarchy availble in the Parameter Store to support the conventions.</p>
<ul>
<li>name: /capability/environment/application/key</li>
<li>value: <em>the secret</em></li>
<li><mark class="critic"> Required IAM policy </mark></li>
</ul>
<h3 id="kubernetes">Kubernetes<a class="headerlink" href="#kubernetes" title="Permanent link">&para;</a></h3>
<p>Secrets are created and maintained in Kubernetes based on the following convetions:</p>
<ul>
<li>target_namespace: capability</li>
<li>secret_name: environment_application_secret</li>
<li>content:<ul>
<li>key: value</li>
<li>key: value</li>
<li>...</li>
</ul>
</li>
</ul>
<h2 id="consuming-secrets-in-kubernetes">Consuming Secrets in Kubernetes<a class="headerlink" href="#consuming-secrets-in-kubernetes" title="Permanent link">&para;</a></h2>
<h3 id="targets">Targets<a class="headerlink" href="#targets" title="Permanent link">&para;</a></h3>
<ul>
<li>Environment variable</li>
<li>Files (certificates, etc)</li>
</ul>
<h3 id="example-kubernetes-manifests">Example kubernetes manifests<a class="headerlink" href="#example-kubernetes-manifests" title="Permanent link">&para;</a></h3>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="application-developers/" title="Application Developers" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Application Developers
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="./assets/javascripts/application.5c3774b5.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"."}})</script>
      
    
    
      
    
  </body>
</html>